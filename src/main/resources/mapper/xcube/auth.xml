<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="auth">
	<!--권한관리-->
	<select id="selectAuthManageList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
					SELECT MASTER_LICENSE_LIST_OBID,
						   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
						   EMAIL,
						   NAME,
						   REQ_GRADE,
						   GRADE
					  FROM PARTICIPATE_AUTH_LIST
					 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'email'">
		    AND EMAIL LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<if test="searchKey == 'name'">
		    AND NAME LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<![CDATA[
					ORDER BY CREATED_ON ASC
					)X
		]]>	
	</select>

	<select id="selectAuthManage" resultType="ParamMap">
		SELECT 	MASTER_LICENSE_LIST_OBID,
				DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
				EMAIL,
				NAME,
				REQ_GRADE,
				GRADE
		   FROM PARTICIPATE_AUTH_LIST
		  WHERE EMAIL = #{email}
			AND MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</select>

	<insert id="insertAuthManage" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_AUTH_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			NAME,
			REQ_GRADE,
			GRADE
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{name},
			#{reqGrade},
			#{grade}
		)
	</insert>

	<update id="updateAuthManage" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_AUTH_LIST
		   SET NAME = #{name},
			   REQ_GRADE = #{reqGrade},
			   GRADE = #{grade}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<update id="updateAuthManageAuth" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_AUTH_LIST
		   SET GRADE = #{grade}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<delete id="deleteAuthManage" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_AUTH_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</delete>
</mapper>
