<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="manage">

	<!--참가신청관리-->
	<select id="selectParticipateManageList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
				SELECT MASTER_LICENSE_LIST_OBID,
				       DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
					   EMAIL,
					   NAME,
					   USER_TYPE,
					   APPROVAL_CODE,
					   COMPANY_NAME,
					   HOMEPAGE,
					   OWNER,
					   IDN,
					   MANAGER_NAME,
					   MANAGER_JOB_POSITION,
					   MANAGER_EMAIL,
					   MANAGER_TEL,
					   ADDR,
					   INTRODUCE,
					   COMPANY_MAIN_OBJECTS,
					   ATTATCH_FILE_OBID
				  FROM PARTICIPATE_COMPANY_LIST
				 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'companyName'">
			   AND COMPANY_NAME LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<if test="searchKey == 'approvalCode'">
			   AND APPROVAL_CODE = #{searchKeyWord}
		</if>
		<![CDATA[
				ORDER BY CREATED_ON DESC
			) X
		]]>
	</select>

	<select id="selectParticipateManage" resultType="ParamMap">
		SELECT MASTER_LICENSE_LIST_OBID,
			   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			   EMAIL,
			   NAME,
			   USER_TYPE,
			   APPROVAL_CODE,
			   COMPANY_NAME,
			   HOMEPAGE,
			   OWNER,
			   IDN,
			   MANAGER_NAME,
			   MANAGER_JOB_POSITION,
			   MANAGER_EMAIL,
			   MANAGER_TEL,
			   ADDR,
			   INTRODUCE,
			   COMPANY_MAIN_OBJECTS,
			   ATTATCH_FILE_OBID
		  FROM PARTICIPATE_COMPANY_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</select>

	<insert id="insertParticipateManage" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_COMPANY_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			NAME,
			USER_TYPE,
			APPROVAL_CODE,
			COMPANY_NAME,
			HOMEPAGE,
			OWNER,
			IDN,
			MANAGER_NAME,
			MANAGER_JOB_POSITION,
			MANAGER_EMAIL,
			MANAGER_TEL,
			ADDR,
			INTRODUCE,
			COMPANY_MAIN_OBJECTS,
			ATTATCH_FILE_OBID
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{name},
			#{userType},
			#{approvalCode},
			#{companyName},
			#{homepage},
			#{owner},
			#{idn},
			#{managerName},
			#{managerJobPosition},
			#{managerEmail},
			#{managerTel},
			#{addr},
			#{introduce},
			#{companyMainObjects},
			#{attatchFileObid}
		)
	</insert>

	<update id="updateParticipateManage" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_COMPANY_LIST
		   SET NAME = #{name},
			   USER_TYPE = #{userType},
			   COMPANY_NAME = #{companyName},
			   HOMEPAGE = #{homepage},
			   OWNER = #{owner},
			   IDN = #{idn},
			   MANAGER_NAME = #{managerName},
			   MANAGER_JOB_POSITION = #{managerJobPosition},
			   MANAGER_EMAIL = #{managerEmail},
			   MANAGER_TEL = #{managerTel},
			   ADDR = #{addr},
			   INTRODUCE = #{introduce},
			   COMPANY_MAIN_OBJECTS = #{companyMainObjects},
			   ATTATCH_FILE_OBID = #{attatchFileObid}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<update id="updateParticipateManageApproval" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_COMPANY_LIST
		   SET APPROVAL_CODE = #{approvalCode}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<delete id="deleteParticipateManage" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_COMPANY_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</delete>

	<!--권한관리-->
	<select id="selectAuthManageList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
					SELECT MASTER_LICENSE_LIST_OBID,
						   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
						   EMAIL,
						   NAME,
						   REQ_GRADE,
						   GRADE
					  FROM PARTICIPATE_USER_LIST
					 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'email'">
		    AND EMAIL LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<if test="searchKey == 'name'">
		    AND NAME LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<![CDATA[
					ORDER BY CREATED_ON DESC
					)X
		]]>	
	</select>

	<select id="selectAuthManage" resultType="ParamMap">
		SELECT 	MASTER_LICENSE_LIST_OBID,
				DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
				EMAIL,
				NAME,
				REQ_GRADE,
				GRADE
		   FROM PARTICIPATE_USER_LIST
		  WHERE EMAIL = #{email}
			AND MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</select>

	<insert id="insertAuthManage" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_USER_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			NAME,
			REQ_GRADE,
			GRADE
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{name},
			#{reqGrade},
			#{grade}
		)
	</insert>

	<update id="updateAuthManage" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_USER_LIST
		   SET NAME = #{name},
			   REQ_GRADE = #{reqGrade},
			   GRADE = #{grade}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<update id="updateAuthManageAuth" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_USER_LIST
		   SET GRADE = #{grade}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<delete id="deleteAuthManage" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_USER_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</delete>

	<!--3D제작요청관리-->
	<select id="select3DManageList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
					SELECT OBID,
					       MASTER_LICENSE_LIST_OBID,
						   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
						   EMAIL,
						   FILE_NAME,
						   FILE_TYPE,
						   FILE_DESCRIPT,
						   ATTATCH_FILE_OBID,
						   IMG_ATTATCH_FILE_OBID
					  FROM REQ_3D_DATA_LIST
					 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'fileType'">
		    AND FILE_TYPE = #{searchKeyWord}
		</if>
		<![CDATA[
				ORDER BY CREATED_ON DESC
					) X
		]]>	
	</select>

	<select id="select3DManage" resultType="ParamMap">
		SELECT A.OBID,
			   A.MASTER_LICENSE_LIST_OBID,
			   DATE_FORMAT(A.CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			   A.EMAIL,
			   A.FILE_NAME,
			   A.FILE_TYPE,
			   A.FILE_DESCRIPT,
			   A.ATTATCH_FILE_OBID,
			   A.IMG_ATTATCH_FILE_OBID
		  FROM REQ_3D_DATA_LIST A
		 WHERE A.OBID = #{obid}
	</select>

	<insert id="insert3DManage" parameterType="java.util.HashMap">
		INSERT INTO REQ_3D_DATA_LIST
		(
			OBID,
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			FILE_NAME,
			FILE_TYPE,
			FILE_DESCRIPT,
			ATTATCH_FILE_OBID,
			IMG_ATTATCH_FILE_OBID
		)
		VALUES 
		(
			#{obid},
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{fileName},
			#{fileType},
			#{fileDescript},
			#{attatchFileObid},
			#{imgAttatchFileObid}
		)
	</insert>

	<update id="update3DManage" parameterType="java.util.HashMap">
		UPDATE REQ_3D_DATA_LIST
		   SET MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid},
		       FILE_NAME = #{fileName},
			   FILE_TYPE = #{fileType},
			   FILE_DESCRIPT = #{fileDescript},
			   ATTATCH_FILE_OBID = #{attatchFileObid},
			   IMG_ATTATCH_FILE_OBID = #{imgAttatchFileObid}
		 WHERE OBID = #{obid}
	</update>

	<delete id="delete3DManage" parameterType="java.util.HashMap">
		DELETE FROM REQ_3D_DATA_LIST
		 WHERE OBID = #{obid}
	</delete>

	<delete id="delete3DManageList" parameterType="java.util.HashMap">
		DELETE FROM REQ_3D_DATA_LIST
		 WHERE OBID IN 
		 <foreach collection="list" item="item" open="(" separator="," close=")">
			#{item.obid}
		</foreach>
	</delete>
</mapper>
