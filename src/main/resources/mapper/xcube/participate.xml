<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="participate">
	<!--참가신청관리-->
	<select id="selectParticipateManageList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
				SELECT MASTER_LICENSE_LIST_OBID,
				       DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
					   EMAIL,
					   NAME,
					   APPROVAL_CODE,
					   BUSINESS_TYPE,
					   HOMEPAGE,
					   OWNER,
					   IDN,
					   MANAGER_NAME,
					   MANAGER_JOB_POSITION,
					   MANAGER_EMAIL,
					   MANAGER_TEL,
					   ADDR,
					   INTRODUCE,
					   COMPANY_MAIN_OBJECTS,
					   ATTATCH_FILE_OBID,
					   REQ_SCALE_TYPE,
					   REQ_SCALE
				  FROM PARTICIPATE_APPLY_LIST
				 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'companyName'">
			   AND COMPANY_NAME LIKE CONCAT('%',#{searchKeyWord},'%')
		</if>
		<if test="searchKey == 'approvalCode'">
			   AND APPROVAL_CODE = #{searchKeyWord}
		</if>
		<![CDATA[
				ORDER BY CREATED_ON ASC
			) X
		]]>
	</select>

	<select id="selectParticipateManage" resultType="ParamMap">
		SELECT MASTER_LICENSE_LIST_OBID,
			   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			   EMAIL,
			   NAME,
			   APPROVAL_CODE,
			   COMPANY_NAME,
			   BUSINESS_TYPE,
			   HOMEPAGE,
			   OWNER,
			   IDN,
			   MANAGER_NAME,
			   MANAGER_JOB_POSITION,
			   MANAGER_EMAIL,
			   MANAGER_TEL,
			   ADDR,
			   INTRODUCE,
			   COMPANY_MAIN_OBJECTS,
			   ATTATCH_FILE_OBID,
			   REQ_SCALE_TYPE,
			   REQ_SCALE
		  FROM PARTICIPATE_APPLY_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</select>

	<insert id="insertParticipateManage" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_APPLY_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			NAME,
			APPROVAL_CODE,
			COMPANY_NAME,
			BUSINESS_TYPE,
			HOMEPAGE,
			OWNER,
			IDN,
			MANAGER_NAME,
			MANAGER_JOB_POSITION,
			MANAGER_EMAIL,
			MANAGER_TEL,
			ADDR,
			INTRODUCE,
			COMPANY_MAIN_OBJECTS,
			ATTATCH_FILE_OBID,
			REQ_SCALE_TYPE,
			REQ_SCALE
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{name},
			#{approvalCode},
			#{companyName},
			#{businessType},
			#{homepage},
			#{owner},
			#{idn},
			#{managerName},
			#{managerJobPosition},
			#{managerEmail},
			#{managerTel},
			#{addr},
			#{introduce},
			#{companyMainObjects},
			#{attatchFileObid},
			#{reqScaleType},
			#{reqScale}

		)
	</insert>

	<update id="updateParticipateManage" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_APPLY_LIST
		   SET NAME = #{name},
			   COMPANY_NAME = #{companyName},
			   BUSINESS_TYPE = #{businessType},
			   HOMEPAGE = #{homepage},
			   OWNER = #{owner},
			   IDN = #{idn},
			   MANAGER_NAME = #{managerName},
			   MANAGER_JOB_POSITION = #{managerJobPosition},
			   MANAGER_EMAIL = #{managerEmail},
			   MANAGER_TEL = #{managerTel},
			   ADDR = #{addr},
			   INTRODUCE = #{introduce},
			   COMPANY_MAIN_OBJECTS = #{companyMainObjects},
			   ATTATCH_FILE_OBID = #{attatchFileObid},
			   REQ_SCALE_TYPE = #{reqScaleType},
			   REQ_SCALE = #{reqScale}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<update id="updateParticipateManageApproval" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_APPLY_LIST
		   SET APPROVAL_CODE = #{approvalCode}
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</update>

	<delete id="deleteParticipateManage" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_APPLY_LIST
		 WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
		   AND EMAIL = #{email}
	</delete>
</mapper>
