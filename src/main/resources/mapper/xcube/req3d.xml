<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="req3d">
	<!--3D제작요청관리-->
	<select id="selectReq3dList" resultType="ParamMap">
		<![CDATA[
			SELECT ROW_NUMBER() OVER() AS NUM, 
			       X.*
			  FROM (
					SELECT OBID,
					       MASTER_LICENSE_LIST_OBID,
						   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
						   EMAIL,
						   FILE_NAME,
						   FILE_TYPE,
						   FILE_DESCRIPT,
						   ATTATCH_FILE_OBID,
						   IMAGE_FILE_OBID,
						   REQ_STATUS,
						   DONE
					  FROM REQ_3D_DATA_LIST
					 WHERE 1=1
		]]>
		<if test="masterLicenseListObid != null and masterLicenseListObid !=''">
			AND MASTER_LICENSE_LIST_OBID IN
			<foreach collection="masterLicenseListObid" item="item" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="searchKey == 'fileType'">
		    AND FILE_TYPE = #{searchKeyWord}
		</if>
		<![CDATA[
				ORDER BY CREATED_ON ASC
					) X
		]]>	
	</select>

	<select id="selectReq3d" resultType="ParamMap">
		SELECT OBID,
			   MASTER_LICENSE_LIST_OBID,
			   DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			   EMAIL,
			   FILE_NAME,
			   FILE_TYPE,
			   FILE_DESCRIPT,
			   ATTATCH_FILE_OBID,
			   IMAGE_FILE_OBID,
			   REQ_STATUS,
			   DONE
		  FROM REQ_3D_DATA_LIST
		 WHERE OBID = #{obid}
	</select>

	<insert id="insertReq3d" parameterType="java.util.HashMap">
		INSERT INTO REQ_3D_DATA_LIST
		(
			OBID,
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			EMAIL,
			FILE_NAME,
			FILE_TYPE,
			FILE_DESCRIPT,
			ATTATCH_FILE_OBID,
			IMAGE_FILE_OBID,
			REQ_STATUS,
			DONE
		)
		VALUES 
		(
			#{obid},
			#{masterLicenseListObid},
			SYSDATE(),
			#{email},
			#{fileName},
			#{fileType},
			#{fileDescript},
			#{attatchFileObid},
			#{imageFileObid},
			#{reqStatus},
			#{done}
		)
	</insert>

	<update id="updateReq3d" parameterType="java.util.HashMap">
		UPDATE REQ_3D_DATA_LIST
		   SET MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid},
		       FILE_NAME = #{fileName},
			   FILE_TYPE = #{fileType},
			   FILE_DESCRIPT = #{fileDescript},
			   ATTATCH_FILE_OBID = #{attatchFileObid},
			   IMAGE_FILE_OBID = #{imageFileObid},
			   REQ_STATUS = #{reqStatus},
			   DONE = #{done}
		 WHERE OBID = #{obid}
	</update>

	<update id="updateReq3dStatus" parameterType="java.util.HashMap">
		UPDATE REQ_3D_DATA_LIST
		   SET REQ_STATUS = #{reqStatus}
		 WHERE OBID = #{obid}
	</update>

	<update id="updateReq3dDone" parameterType="java.util.HashMap">
		UPDATE REQ_3D_DATA_LIST
		   SET DONE = #{done}
		 WHERE OBID = #{obid}
	</update>

	<delete id="deleteReq3d" parameterType="java.util.HashMap">
		DELETE FROM REQ_3D_DATA_LIST
		 WHERE OBID = #{obid}
	</delete>

	<delete id="deleteReq3dList" parameterType="java.util.HashMap">
		DELETE FROM REQ_3D_DATA_LIST
		 WHERE OBID IN 
		 <foreach collection="list" item="item" open="(" separator="," close=")">
			#{item.obid}
		</foreach>
	</delete>
</mapper>
