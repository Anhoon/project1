<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="master">
	
	<select id="selectMasterLicenseList" resultType="ParamMap">
		SELECT
			DATE_FORMAT(A.CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			A.EMAIL, 
			A.ORGANIZER, 
			A.TEL, 
			A.MANAGER, 
			A.JOB_POSITION, 
			A.HOMEPAGE,
			A.TITLE,
			B.OBID, 
			B.MASTER_LICENSE_OBID,
			B.TYPE, 
			B.STATUS, 
			DATE_FORMAT(B.START_DATE,'%Y-%m-%d %T') AS START_DATE,
			DATE_FORMAT(B.END_DATE,'%Y-%m-%d %T') AS END_DATE,
			B.EXPRESSION, 
			B.HOLD_TYPE
		FROM MASTER_LICENSE A , MASTER_LICENSE_LIST B
		WHERE A.OBID = B.MASTER_LICENSE_OBID
		AND A.EMAIL = #{email}
		<if test="status != null and status != '' " >
			AND B.STATUS = #{status}
		</if>
	</select>

	<insert id="insertMasterLicense" parameterType="java.util.HashMap">
		INSERT INTO MASTER_LICENSE 
		(
			OBID, 
			CREATED_ON, 
			EMAIL, 
			ORGANIZER, 
			TEL, 
			MANAGER, 
			JOB_POSITION, 
			HOMEPAGE, 
			TITLE
		) 
		VALUES 
		(
			#{obid},
			SYSDATE(),
			#{email}, 
			#{organizer},
			#{tel},
			#{manager},
			#{jobPosition},
			#{homepage},
			#{title}
		)
	</insert>

	<insert id="insertMasterLicenseList" parameterType="java.util.List">
		INSERT INTO MASTER_LICENSE_LIST 
		(
			OBID, 
			MASTER_LICENSE_OBID, 
			TYPE,
			TITLE,
			STATUS, 
			START_DATE, 
			END_DATE, 
			EXPRESSION, 
			HOLD_TYPE
		) 
		VALUES
		<foreach collection="list" item="item" separator=",">
		(
			#{item.obid},
			#{item.masterLicenseObid}, 
			#{item.type},
			#{item.title},
			#{item.status},
			CONVERT(#{item.startDate}, DATETIME),
			CONVERT(#{item.endDate}, DATETIME),
			#{item.expression},
			#{item.holdType}
		)
		</foreach>
	</insert>

	<update id="updateMasterLicense" parameterType="java.util.HashMap">
		UPDATE MASTER_LICENSE SET
			ORGANIZER = #{organizer},
			TEL = #{tel}, 
			MANAGER = #{manager}, 
			JOB_POSITION = #{jobPosition}, 
			HOMEPAGE = #{homepage}, 
			HISTORY = #{history}
		WHERE OBID = #{obid}
	</update>

	<update id="updateMasterLicenseList" parameterType="java.util.HashMap">
		UPDATE MASTER_LICENSE_LIST SET
			TITLE = #{title},
			TYPE = #{type},
			STATUS = #{status},
			START_DATE = #{startDate},
			END_DATE = #{endDate},
			EXPRESSION = #{expression},
			HOLD_TYPE = #{holdType}
		WHERE MASTER_LICENSE_OBID = #{masterLicenseObid}
	</update>

	<update id="updateMasterLicenseStatus" parameterType="java.util.HashMap">
		UPDATE MASTER_LICENSE_LIST SET
			STATUS = #{status}
		WHERE OBID = #{obid}
	</update>
</mapper>