<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="event">
	
	<select id="selectEventList" resultType="ParamMap">
		SELECT A.* FROM (
			SELECT 
				A.REF_OBID,
				A.CREATED_ON,
				A.TITLE,
				A.EN_TITLE,
				A.ALIAS,
				A.OBJECTS,
				A.CONTENTS,
				A.SHOW_PRODUCTS,
				A.ORGANIZER,
				A.SUBJECTIVITY,
				A.SUPPORT,
				A.HOMPAGE,
				A.PROGRAM,
				A.ATTATCH_REF_OBID,
				(SELECT TYPE FROM MASTER_LICENSE_LIST WHERE OBID = A.REF_OBID) AS TYPE,
				(
				SELECT 
					(CASE TYPE WHEN 'C' THEN '컨벤션' 
							WHEN 'E' THEN '전시회' 
							WHEN 'F' THEN '컨퍼런스' 
							WHEN 'S' THEN '공연' 
							ELSE '미등록코드' END
					) AS TYPE  
				FROM MASTER_LICENSE_LIST WHERE OBID = A.REF_OBID
				) AS TYPE_NM,
				B.OBJECT_FOR,
				(CASE B.OBJECT_FOR WHEN '0' THEN '전체' WHEN '1' THEN '일반' WHEN '2' THEN '기업' END) OBJECT_FOR_NM
			FROM EVENT_LIST A, PARTICIPATE_LIST B
			WHERE A.REF_OBID = B.REF_OBID
		) A
		WHERE 1=1
		<if test="type != null and type != '' " >
			AND TYPE = #{type}
		</if>
		<if test="searchKey != null and searchKey != '' " >
			AND TYPE = #{searchKey}
		</if>
		<if test="searchKeyWord != null and searchKeyWord != '' " >
			AND TYPE = #{searchKeyWord}
		</if>
	</select>

	<select id="selectEvent" resultType="ParamMap">
		SELECT 
			REF_OBID,
			DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			TITLE,
			EN_TITLE,
			ALIAS,
			OBJECTS,
			CONTENTS,
			SHOW_PRODUCTS,
			ORGANIZER,
			SUBJECTIVITY,
			SUPPORT,
			HOMPAGE,
			PROGRAM,
			ATTATCH_REF_OBID
		FROM EVENT_LIST
		WHERE REF_OBID = #{refObid}
	</select>

	<select id="selectParticipate" resultType="ParamMap">
		SELECT 
			REF_OBID,
			DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			OBJECT_FOR,
			SCALE,
			QUALIFY_APPLY_OBJECTS,
			DATE_FORMAT(START_APPLY_DATE,'%Y-%m-%d %T') AS START_OBJECTS_DATE,
			DATE_FORMAT(END_APPLY_DATE,'%Y-%m-%d %T') AS END_OBJECTS_DATE,
			SUPPORT_CONTENT,
			APPLY_DOC,
			APPLY_TYPE,
			APPLY_COUNT,
			APPLY_FEE,
			APPLY_FOR_OBJECT,
			ATTATCH_REF_OBID
		FROM PARTICIPATE_LIST
		WHERE REF_OBID = #{refObid}
	</select>

	<insert id="insertEvent" parameterType="java.util.HashMap">
		INSERT INTO EVENT_LIST
		(
			REF_OBID,
			CREATED_ON,
			TITLE,
			EN_TITLE,
			ALIAS,
			OBJECTS,
			CONTENTS,
			SHOW_PRODUCTS,
			ORGANIZER,
			SUBJECTIVITY,
			SUPPORT,
			HOMPAGE,
			PROGRAM,
			ATTATCH_REF_OBID
		)
		VALUES 
		(
			#{refObid},
			SYSDATE(),
			#{title},
			#{enTitle},
			#{alias},
			#{objects},
			#{contents},
			#{showProducts},
			#{organizer},
			#{subjectivity},
			#{support},
			#{hompage},
			#{program},
			#{attatchRefObid}
		)
	</insert>

	<insert id="insertParticipate" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_LIST
		(
			REF_OBID,
			CREATED_ON,
			OBJECT_FOR,
			SCALE,
			QUALIFY_APPLY_OBJECTS,
			START_APPLY_DATE,
			END_APPLY_DATE,
			SUPPORT_CONTENT,
			APPLY_DOC,
			APPLY_TYPE,
			APPLY_COUNT,
			APPLY_FEE,
			APPLY_FOR_OBJECT,
			ATTATCH_REF_OBID
		)
		VALUES 
		(
			#{refObid},
			SYSDATE(),
			#{objectFor},
			#{scale},
			#{qualifyApplyObjects},
			CONVERT(#{startApplyDate}, DATETIME),
			CONVERT(#{endApplyDate}, DATETIME),
			#{supportContent},
			#{applyDoc},
			#{applyType},
			#{applyCount},
			#{applyFee},
			#{applyForObject},
			#{attatchRefObid}
		)
	</insert>

	<update id="updateEvent" parameterType="java.util.HashMap">
		UPDATE EVENT_LIST SET
			TITLE = #{title},
			EN_TITLE = #{enTitle},
			ALIAS = #{alias},
			OBJECTS = #{objects},
			CONTENTS = #{contents},
			SHOW_PRODUCTS = #{showProducts},
			ORGANIZER = #{organizer},
			SUBJECTIVITY = #{subjectivity},
			SUPPORT = #{support},
			HOMPAGE = #{hompage},
			PROGRAM = #{program}
		WHERE REF_OBID = #{refObid}
	</update>

	<update id="updateParticipate" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_LIST SET
			OBJECT_FOR = #{objectFor},
			QUALIFY_APPLY_OBJECTS = #{qualifyApplyObjects},
			SCALE = #{scale},
			START_APPLY_DATE = CONVERT(#{startApplyDate}, DATETIME),
			END_APPLY_DATE = CONVERT(#{endOApplyDate}, DATETIME),
			SUPPORT_CONTENT = #{supportContent},
			APPLY_DOC = #{applyDoc},
			APPLY_TYPE = #{applyType},
			APPLY_COUNT = #{applyCount},
			APPLY_FEE = #{applyFee},
			APPLY_FOR_OBJECT = #{applyForObject}
		WHERE REF_OBID = #{refObid}
	</update>

	<delete id="deleteEvent" parameterType="java.util.HashMap">
		DELETE FROM EVENT_LIST
		WHERE REF_OBID = #{refObid}
	</delete>

	<delete id="deleteParticipate" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_LIST
		WHERE REF_OBID = #{refObid}
	</delete>
</mapper>