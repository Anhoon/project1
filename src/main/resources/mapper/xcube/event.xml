<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="event">
	
	<select id="selectEventList" resultType="ParamMap">
		SELECT A.* FROM (
			SELECT 
				A.MASTER_LICENSE_LIST_OBID,
				A.TYPE,
				B.OBJECT_FOR,
				A.TITLE,
				DATE_FORMAT(A.START_DATE,'%Y-%m-%d %T') AS START_DATE,
				DATE_FORMAT(A.END_DATE,'%Y-%m-%d %T') AS END_DATE,
				DATE_FORMAT(B.START_APPLY_DATE,'%Y-%m-%d %T') AS START_APPLY_DATE,
				DATE_FORMAT(B.END_APPLY_DATE,'%Y-%m-%d %T') AS END_APPLY_DATE
			FROM EVENT_LIST A , PARTICIPATE_LIST B
			WHERE A.MASTER_LICENSE_LIST_OBID = B.MASTER_LICENSE_LIST_OBID
			<if test="status != null and status != '' " >
				AND A.STATUS = #{status}
			</if>
			<if test="sattu != null and type != '' " >
				AND TYPE = #{type}
			</if>
			<if test="searchKey == 'title'">
			   AND A.TITLE LIKE CONCAT('%',#{searchKeyWord},'%')
			</if>
			ORDER BY B.CREATED_ON DESC
		) A
	</select>

	<select id="selectEvent" resultType="ParamMap">
		SELECT 
			MASTER_LICENSE_LIST_OBID,
			DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			TITLE,
			EN_TITLE,
			ALIAS,
			OBJECTS,
			CONTENTS,
			SHOW_PRODUCTS,
			ORGANIZER,
			SUBJECTIVITY,
			SUPPORT,
			HOMPAGE,
			ATTATCH_FILE_OBID,
			SUBJECT,
			PROGRAM,
			TYPE,
			START_DATE,
			END_DATE,
			EMAIL,
			STATUS
		FROM EVENT_LIST
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</select>

	<select id="selectParticipate" resultType="ParamMap">
		SELECT 
			MASTER_LICENSE_LIST_OBID,
			DATE_FORMAT(CREATED_ON,'%Y-%m-%d %T') AS CREATED_ON,
			OBJECT_FOR,
			(CASE OBJECT_FOR WHEN '0' THEN '전체' WHEN '1' THEN '일반' WHEN '2' THEN '기업' END) OBJECT_FOR_NM,
			SCALE,
			QUALIFY_APPLY_OBJECTS,
			DATE_FORMAT(START_APPLY_DATE,'%Y-%m-%d %T') AS START_OBJECTS_DATE,
			DATE_FORMAT(END_APPLY_DATE,'%Y-%m-%d %T') AS END_OBJECTS_DATE,
			SUPPORT_CONTENT,
			APPLY_DOC,
			APPLY_TYPE,
			APPLY_COUNT,
			APPLY_FEE,
			APPLY_FOR_OBJECT,
			ATTATCH_FILE_OBID
		FROM PARTICIPATE_LIST
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</select>

	<insert id="insertEvent" parameterType="java.util.HashMap">
		INSERT INTO EVENT_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			TITLE,
			EN_TITLE,
			ALIAS,
			OBJECTS,
			CONTENTS,
			SHOW_PRODUCTS,
			ORGANIZER,
			SUBJECTIVITY,
			SUPPORT,
			HOMPAGE,
			ATTATCH_FILE_OBID,
			SUBJECT,
			PROGRAM,
			TYPE,
			START_DATE,
			END_DATE,
			EMAIL,
			STATUS
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{title},
			#{enTitle},
			#{alias},
			#{objects},
			#{contents},
			#{showProducts},
			#{organizer},
			#{subjectivity},
			#{support},
			#{hompage},
			#{attatchFileObid},
			#{subject},
			#{program},
			#{type},
			CONVERT(#{startDate}, DATETIME),
			CONVERT(#{endDate}, DATETIME),
			#{email},
			#{status}
		)
	</insert>

	<insert id="insertParticipate" parameterType="java.util.HashMap">
		INSERT INTO PARTICIPATE_LIST
		(
			MASTER_LICENSE_LIST_OBID,
			CREATED_ON,
			OBJECT_FOR,
			SCALE,
			QUALIFY_APPLY_OBJECTS,
			START_APPLY_DATE,
			END_APPLY_DATE,
			SUPPORT_CONTENT,
			APPLY_DOC,
			ATTATCH_FILE_OBID,
			APPLY_TYPE,
			APPLY_COUNT,
			APPLY_FEE,
			APPLY_FOR_OBJECT,
			STATUS
		)
		VALUES 
		(
			#{masterLicenseListObid},
			SYSDATE(),
			#{objectFor},
			#{scale},
			#{qualifyApplyObjects},
			CONVERT(#{startApplyDate}, DATETIME),
			CONVERT(#{endApplyDate}, DATETIME),
			#{supportContent},
			#{applyDoc},
			#{attatchFileObid},
			#{applyType},
			#{applyCount},
			#{applyFee},
			#{applyForObject},
			#{status}
		)
	</insert>

	<update id="updateEvent" parameterType="java.util.HashMap">
		UPDATE EVENT_LIST SET
			TITLE = #{title},
			EN_TITLE = #{enTitle},
			ALIAS = #{alias},
			OBJECTS = #{objects},
			CONTENTS = #{contents},
			SHOW_PRODUCTS = #{showProducts},
			ORGANIZER = #{organizer},
			SUBJECTIVITY = #{subjectivity},
			SUPPORT = #{support},
			HOMPAGE = #{hompage},
			ATTATCH_FILE_OBID = #{attatchFileObid},
			PROGRAM = #{program},
			SUBJECT = #{subject},
			TYPE = #{type},
			START_DATE = CONVERT(#{startDate}, DATETIME),
			END_DATE = CONVERT(#{endDate}, DATETIME),
			EMAIL = #{email}
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</update>

	<update id="updateParticipate" parameterType="java.util.HashMap">
		UPDATE PARTICIPATE_LIST SET
			OBJECT_FOR = #{objectFor},
			QUALIFY_APPLY_OBJECTS = #{qualifyApplyObjects},
			SCALE = #{scale},
			START_APPLY_DATE = CONVERT(#{startApplyDate}, DATETIME),
			END_APPLY_DATE = CONVERT(#{endOApplyDate}, DATETIME),
			SUPPORT_CONTENT = #{supportContent},
			APPLY_DOC = #{applyDoc},
			APPLY_TYPE = #{applyType},
			APPLY_COUNT = #{applyCount},
			APPLY_FEE = #{applyFee},
			APPLY_FOR_OBJECT = #{applyForObject},
			ATTATCH_FILE_OBID = #{attatchFileObid}
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</update>

	<delete id="deleteEvent" parameterType="java.util.HashMap">
		DELETE FROM EVENT_LIST
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</delete>

	<delete id="deleteParticipate" parameterType="java.util.HashMap">
		DELETE FROM PARTICIPATE_LIST
		WHERE MASTER_LICENSE_LIST_OBID = #{masterLicenseListObid}
	</delete>
</mapper>